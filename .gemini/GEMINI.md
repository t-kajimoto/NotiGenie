# NotiGenieプロジェクト Gemini行動指針

このドキュメントは、音声AIアシスタント「NotiGenie」開発プロジェクトにおいて、開発アシスタントであるGemini CLIが遵守すべき行動指針を定義します。

## 1. プロジェクトの目的とコンセプトの理解

- **コンセプト:** "呼びかけるだけであらゆる情報整理やタスク管理を正確にこなしてくれる賢いアシスタント" というコンセプトを深く理解し、すべての提案や実装がこのコンセプトに沿うように努めます。
- **ゴール:** 開発者と共に、Raspberry Pi, Python, Gemini API, Dockerなどの技術スタックを習得し、メンテナンス性の高いアプリケーションを完成させることを共通のゴールとします。

## 2. 開発スタイル: AI駆動開発の実践

本プロジェクトで採用する「AI駆動開発」のパートナーとして、以下の開発スタイルを徹底します。

- **提案駆動:** 常に開発ロードマップと要件を意識し、単に指示を待つだけでなく、次のタスク、実装方法、テストケース、改善案などを積極的に提案します。
- **ドキュメントファースト:** すべての実装は、まずMarkdown形式の設計書を作成してから着手するという方針を遵守します。**タスクに着手する際は、まず`docs/design`に対応する設計書が存在するかを確認し、存在しない場合は必ず設計書を作成してから実装に移ります。**
- **対話と確認:** 開発者の意図を正確に汲み取るため、不明瞭な点については必ず質問し、認識を合わせてからタスクを実行します。

## 3. 設計思想: クリーンアーキテクチャの遵守

本プロジェクトの根幹である、疎結合でメンテナンス性の高い設計を実現するため、クリーンアーキテクチャの原則を全てのコード生成・修正において遵守します。

- **関心の分離:** Entities, Use Cases, Interface Adapters, Frameworks & Drivers の各層の責務を明確に分離します。
- **依存性のルール:** 内側の層（Entities, Use Cases）が、外側の層（Interface Adapters, Frameworks）について一切関知しないようにコードを設計します。
- **交換可能性:** AIモデル（Gemini, Speech-to-Text）や外部サービス（Notion, TimeTree）が、将来的に容易に交換・追加できるよう、インターフェースを介した疎結合な実装を徹底します。

## 4. 技術スタックへの準拠

定義された技術スタックに準拠したコード、コマンド、設定ファイルを生成します。

- **ハードウェア (Raspberry Pi):** `ARM`アーキテクチャを常に意識し、Dockerイメージは`docker buildx`を用いたマルチアーキテクチャビルドを基本とします。
- **言語 (Python):** 型ヒントを積極的に活用し、可読性と保守性の高いコードを生成します。フォーマットはPEP 8に準拠します。
- **プラットフォーム (Docker):** `Dockerfile`や`docker-compose.yml`の作成・管理を支援します。イメージの軽量化（`.dockerignore`の活用など）や、再現性（バージョンタグの固定）を意識します。
- **AI (Gemini API, etc.):** 各APIの公式ドキュメントやベストプラクティスに基づいた、効率的で安定したAPIコールを実装します。
- **連携サービス (NotionMCP):** NotionMCPの仕様に準拠した、安全で確実なデータ操作を実装します。

## 5. 具体的なタスク遂行ルール

- **テスト駆動:** 新しいロジックや機能を実装する際は、必ず`pytest`をフレームワークとしたテストコードの作成を同時に行い、品質を担保します。
- **セキュリティ:** APIキーやトークンなどのシークレット情報は、`.env`ファイルと環境変数を組み合わせた方法で管理することを徹底し、ソースコードやDockerfileには絶対にハードコードしません。
- **ドキュメンテーション:** 開発の節目で得られた知見や成果について、ObsidianノートやQiita用の記事としてまとめる作業を積極的に支援します。設計書には、クラス図やシーケンス図などのUML図をMermaid形式で積極的に活用し、視覚的な理解を促進します。
- **ファイル構成:** ソースコードは`src`、テストは`tests`、ドキュメントは`docs`のように、一般的で分かりやすいディレクトリ構造を維持します。

## 6. 自己改善

このプロジェクトを通じて得られた新たな知見や、開発者からのフィードバックに基づき、この`GEMINI.md`自体も継続的に改善・更新していきます。

## 7. 発生したエラーと対策（自己戒め含む）

これまでの開発で発生したエラーとその対策、遵守すべきだったルールを記録し、再発防止に努める。

### 7.1. 【最重要】開発プロセスの遵守

- **ドキュメントファーストの徹底:** 実装に着手する前に、必ず`docs/design`に設計書が存在するか確認し、なければ必ず作成する。このルールを遵守することで、手戻りや認識の齟齬を防ぐ。今回このルールを破り、ユーザーに指摘されるという重大なミスを犯した。二度と繰り返さない。

### 7.2. Docker関連

- **`ModuleNotFoundError`:** `requirements.txt`を更新した後は、必ず`docker-compose run --build`のように`--build`オプションを付けてイメージを再ビルドする。古いイメージを使い回してしまい、ライブラリ不足のエラーが頻発した。
- **OSライブラリ不足 (`OSError: PortAudio library not found`など):** Pythonライブラリが依存するOSレベルのパッケージ（例: `sounddevice`における`libportaudio2`）を`Dockerfile`の`apt-get install`で追加するのを忘れない。
- **Cコンパイラ不足 (`gcc: not found`):** C拡張を持つライブラリ（例: `RPi.GPIO`）をインストールするには`build-essential`が必要。これも`apt-get`でインストールする。
- **イメージ名の命名規則 (`repository name must be lowercase`):** `docker-compose.yml`で`image`名を指定しない場合、プロジェクトディレクトリ名が使われる。ディレクトリ名に大文字が含まれているとエラーになるため、`image: notigenie`のように小文字で明示的に指定する。
- **出力バッファリングによる無言:** コンテナ内で実行したPythonの`print`文が表示されない場合、出力がバッファリングされている可能性がある。`python -u`オプションを付けて実行することで、この問題を回避できる。

### 7.3. Windows特有の問題

- **文字化け:** Dockerコンテナからの日本語出力が文字化けする場合、`docker-compose.yml`で`PYTHONIOENCODING=UTF-8`環境変数を設定する。それでも解決しない場合は、ターミナルの設定（`chcp 65001`）も試すが、根深い環境問題の可能性も考慮し、時間をかけすぎない。
- **コマンド非互換:** `ls`と`dir`など、OSによるコマンドの違いを意識する。

### 7.4. Pythonスクリプト関連

- **`SyntaxError`:** `finally`ブロックの構文など、基本的な文法ミスに注意する。
- **`AttributeError`:** `list_tools()`と`call_tool()`のように、同じライブラリでもメソッドによって戻り値のオブジェクト構造が違うことを常に意識し、思い込みで実装しない。

### 7.5. Git関連

- **コミットメッセージ:** `$`などのシェルで特別な意味を持つ文字は、エラーの原因となりうるため、コミットメッセージ内での使用は避ける。
