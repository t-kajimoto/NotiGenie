name: Import Notion Schemas to Firestore

# このワークフローがトリガーされるイベントを定義
on:
  push:
    branches:
      - main  # mainブランチへのプッシュを監視
    paths:
      - 'firestore_import_data/**' # このディレクトリの変更を監視
      - 'import_script.py'         # インポートスクリプト自体の変更も監視

# ワークフローで実行される一連のジョブを定義
jobs:
  import-to-firestore:
    # ジョブが実行されるランナー（OS）を指定
    runs-on: ubuntu-latest

    # ジョブの一連のステップを定義
    steps:
      # 1. リポジトリのコードをランナーにチェックアウトする
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Python環境をセットアップする
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      # 3. 必要なPythonライブラリをインストールする
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install google-cloud-firestore

      # 4. Firestoreへのインポートスクリプトを実行する
      #    - GCP_SA_KEY: GitHubリポジトリのSecretsに登録されたサービスアカウントキー
      #    - FIRESTORE_DATABASE: (オプション) 使用するFirestoreデータベースID
      - name: Run import script
        env:
          GCP_SA_KEY: ${{ secrets.GCP_SA_KEY }}
          FIRESTORE_DATABASE: ${{ secrets.FIRESTORE_DATABASE }}
        run: python import_script.py
